---
import BaseLayout from '../layouts/BaseLayout.astro';
import { allAsync } from '../lib/db.js';

// Helper function to get page content
async function getPageContent(pageName: string) {
    const sections = await allAsync(
        'SELECT section_name, content FROM page_content WHERE page_name = ?',
        [pageName]
    );
    
    const content: Record<string, string> = {};
    sections.forEach((section: any) => {
        content[section.section_name] = section.content;
    });
    
    return content;
}

// Fetch the about page content
let content: Record<string, string> = {};
try {
    content = await getPageContent('about');
} catch (error) {
    console.error('About page error:', error);
    content = {};
}

// Use database values only
const bio = content.bio || "";
const hobbies = content.hobbies || "";
const tagline = content.tagline || "";
const quote = content.quote || "";
const quoteAuthor = content.quote_author || "";
---

<BaseLayout title="About - Nadav Moskow">
    <div id="about-page" class="about">
        <img id="picture" src="/images/IMG_7191.jpg" alt="Picture of Nadav">
        {bio && <p>{bio}</p>}
        {hobbies && <p>{hobbies}</p>}
        {tagline && <p>{tagline}</p>}
        {content.contact_prompt ? <p set:html={content.contact_prompt}></p> : <p>Get in touch via the <a href="/contact">contact page</a></p>}
        {quote && (
            <p>
                {quote}<br>
                {quoteAuthor && <strong>{quoteAuthor}</strong>}
            </p>
        )}
    </div>
    <hr>
</BaseLayout>